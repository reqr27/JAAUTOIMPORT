GO
CREATE TABLE [dbo].[FacturasServicios](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[fecha] [date] NULL,
	[id_vehiculo] [int] NULL,
	[id_suplidor] [int] NULL,
	[monto_rd] [decimal](18, 2) NULL,
	[monto_usd] [decimal](18, 2) NULL,
	[facturaSuplidor] [varchar](50) NULL,
	[nota] [varchar](300) NULL,
 CONSTRAINT [PK_FacturasServicios] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

create procedure [dbo].[insertar_factura_servicios]
@idVehiculo int, @mensaje int output, @idSuplidor int, @montoRD float, @montoUSD float, @numeroFactura varchar(50),
@fecha date, @nota varchar(300)
as
set @mensaje = 0
begin
	if not exists (select * from FacturasServicios where facturaSuplidor = @numeroFactura and id_suplidor = @idSuplidor)
		begin
			insert into FacturasServicios(id_vehiculo, id_suplidor, fecha, monto_rd, monto_usd, nota, facturaSuplidor) 
			VALUES (@idVehiculo, @idSuplidor, @fecha, @montoRD, @montoUSD,@nota, @numeroFactura)


			update Vehiculos set total_invertido_rd = total_invertido_rd + @montoRD, total_invertido_usd = total_invertido_usd + @montoUSD
			where id = @idVehiculo

			set @mensaje = 1
		end
	else
		begin
			set @mensaje = 2
		end
	
end




GO